<!DOCTYPE html>
<html lang="en">
<!-- Removed Brevo Conversations code for live chat integration -->

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Purpose - NYOTA FUND</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Minimal spinner styling placed here so UI layout isn't changed */
    .btn-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.6);
      border-top-color: #fff;
      border-radius: 50%;
      vertical-align: middle;
      margin-right: 8px;
      animation: nyota-spin 0.8s linear infinite;
    }
    @keyframes nyota-spin { to { transform: rotate(360deg); } }
    button[disabled] { opacity: 0.7; cursor: not-allowed; }
  </style>
</head>
<body>

<div class="container">

  <p style="font-size:20px; font-weight:bold;">
    What will be your main purpose after receiving your nyota funds?
  </p>

  <form id="purposeForm">

    <label>
      <input type="radio" name="purpose" value="Start a business" required>
      1. <strong>Start a business.</strong>
    </label><br><br>

    <label>
      <input type="radio" name="purpose" value="Top up a business">
      2. <strong>Top up a business.</strong>
    </label><br><br>

    <label>
      <input type="radio" name="purpose" value="Pay school fees">
      3. <strong>Pay school fees.</strong>
    </label><br><br>

    <label>
      <input type="radio" name="purpose" value="Pay bills">
      4. <strong>Pay bills.</strong>
    </label><br><br>

    <label>
      <input type="radio" name="purpose" value="Pay rent">
      5. <strong>Pay rent.</strong>
    </label><br><br>

    <p style="font-style:italic; margin-top:15px;">
      Note. Kindly use your NYOTA FUNDS wisely.
    </p>

    <button type="submit" id="continueBtn" style="margin-top:20px;">Continue</button>

  </form>

</div>

<script>
  // keep existing behaviour: read userPhone from localStorage and redirect to register if missing
  const userPhone = localStorage.getItem("userPhone");

  if (!userPhone) {
    window.location.href = "register.html";
  }

  document.getElementById("purposeForm").addEventListener("submit", function(e){
    e.preventDefault();

    const selectedPurpose = document.querySelector('input[name="purpose"]:checked');

    if (!selectedPurpose) {
      alert("Please select one option to continue.");
      return;
    }

    const continueBtn = document.getElementById('continueBtn');
    const originalBtnHtml = continueBtn.innerHTML;

    // show spinner in button and disable to prevent multiple submits
    continueBtn.disabled = true;
    continueBtn.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span>Processing...';

    try {
      // update localStorage instead of Firebase
      const key = 'nyota_users';
      let users = [];
      try { users = JSON.parse(localStorage.getItem(key) || '[]'); } catch (err) { users = []; }

      // find user by phone and update purpose
      const idx = users.findIndex(u => u.phone === userPhone);
      const purposeObj = {
        purpose: selectedPurpose.value,
        purposeUpdatedAt: new Date().toISOString()
      };

      if (idx >= 0) {
        users[idx] = Object.assign({}, users[idx], purposeObj);
      } else {
        // if user record not present, create a minimal record with phone and purpose
        users.push(Object.assign({ phone: userPhone }, purposeObj));
      }

      localStorage.setItem(key, JSON.stringify(users));

      // small deliberate delay so spinner is visible and feels legit, then redirect
      setTimeout(() => {
        window.location.href = "amount.html";
      }, 2000); // 2 seconds
    } catch (err) {
      // restore button and show error
      continueBtn.disabled = false;
      continueBtn.innerHTML = originalBtnHtml;
      console.error(err);
      alert("Error saving data locally. Please try again.");
    }
  });
</script>

<!-- Start of LiveChat (www.livechat.com) code -->
<script>
    window.__lc = window.__lc || {};
    window.__lc.license = 19513072;
    window.__lc.integration_name = "manual_channels";
    window.__lc.product_name = "livechat";
    (function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[LiveChatWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.livechatinc.com/tracking.js",t.head.appendChild(n)}};!n.__lc.asyncInit&&e.init(),n.LiveChatWidget=n.LiveChatWidget||e}(window,document,[].slice))
</script>
<noscript><a href="https://www.livechat.com/chat-with/19513072/" rel="nofollow">Chat with us</a>, powered by <a href="https://www.livechat.com/?welcome" rel="noopener nofollow" target="_blank">LiveChat</a></noscript>
<!-- End of LiveChat code -->

</body>
 </html>
